<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>간단 채팅 테스트</title>
  </head>
  <body>
    <h1>채팅 테스트</h1>

    <div>
      <label>닉네임: <input id="nickname" /></label>
    </div>
    <div>
      <label>방 ID: <input id="roomId" value="room1" /></label>
      <button id="joinBtn">방 들어가기</button>
    </div>

    <div>
      <input id="message" placeholder="메시지 입력" />
      <button id="sendBtn">보내기</button>
    </div>

    <pre
      id="log"
      style="border: 1px solid #ccc; height: 200px; overflow-y: scroll"
    ></pre>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io("http://localhost:3000");

      const nicknameInput = document.getElementById("nickname");
      const roomInput = document.getElementById("roomId");
      const joinBtn = document.getElementById("joinBtn");
      const msgInput = document.getElementById("message");
      const sendBtn = document.getElementById("sendBtn");
      const logEl = document.getElementById("log");

      let joinedRoom = null;

      function log(text) {
        logEl.textContent += text + "\n";
        logEl.scrollTop = logEl.scrollHeight;
      }

      joinBtn.onclick = () => {
        const roomId = roomInput.value.trim();
        if (!roomId) {
          alert("방 ID를 입력하세요");
          return;
        }
        socket.emit("chat:join", { roomId });
        joinedRoom = roomId;
        log(`[SYSTEM] 방 ${roomId} 에 입장했습니다.`);
      };

      sendBtn.onclick = () => {
        if (!joinedRoom) {
          alert("먼저 방에 들어가세요");
          return;
        }
        const nickname = nicknameInput.value.trim() || "익명";
        const message = msgInput.value.trim();
        if (!message) return;

        socket.emit("chat:send", {
          roomId: joinedRoom,
          nickname,
          message,
        });
        msgInput.value = "";
      };

      socket.on("chat:receive", (payload) => {
        const { nickname, message } = payload;
        log(`${nickname}: ${message}`);
      });

      socket.on("connect", () => {
        log("[SYSTEM] 서버에 연결되었습니다.");
      });

      socket.on("disconnect", () => {
        log("[SYSTEM] 서버에서 연결이 끊어졌습니다.");
      });
    </script>
  </body>
</html>
